# Caddy configuration for serving the Astro static build.
# Run `npm run build` before starting Caddy so the `dist` directory is up to date.

xtemecleaningtx.com, www.xtemecleaningtx.com {
	root * dist
	encode zstd gzip

	# Serve static assets with long-lived caching
	@static_assets {
		path *.css *.js *.mjs *.svg *.png *.jpg *.jpeg *.webp *.ico *.woff *.woff2
	}
	headers @static_assets Cache-Control "public, max-age=31536000, immutable"

	try_files {path} {path}/ /index.html
	file_server

	headers {
		Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
		Referrer-Policy "strict-origin-when-cross-origin"
		Permissions-Policy "geolocation=(), microphone=(), camera=()"
		X-Content-Type-Options "nosniff"
		X-Frame-Options "SAMEORIGIN"
	}

	log {
		output file logs/xtemecleaningtx.access.log
		format console
	}

	handle_errors {
		@404 {
			expression {http.error.status_code} == 404
		}
		handle @404 {
			rewrite * /index.html
			file_server
		}
	}
}
